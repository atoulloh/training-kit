<?php
require("Sajax.php");
require("koneksi.php");

function getData($nama) {
	if ($nama=="") {
		$sql = "SELECT * FROM admin WHERE user IS NULL OR user Like '%".$nama."%'";
	} else {
		$sql = "SELECT * FROM admin WHERE user Like '%".$nama."%'";
	}
	$result = mysql_query($sql);
	$strx = "";
	while ($row = mysql_fetch_object($result)) {
		$strx .= "|".$row->id."|".$row->nama."|".$row->email."|".$row->kelamin."|".$row->user."|".$row->password;
	}		
	$strx .= "|";
	mysql_free_result($result);
	return $strx;
}

function addData($id, $nama, $email, $kelamin, $user, $password) {
	$sql = "INSERT INTO admin VALUES ('".$id."','".$nama."','".$email."','".$kelamin."','".$user."','".$password."')";
	$query = mysql_query($sql);
	return mysql_affected_rows();
}

function editData($id, $nama, $email, $kelamin, $user, $password) {
	$sql = "UPDATE admin SET id='".$id."', nama='".$nama."',email='".$email."',kelamin='".$kelamin."',user='".$user."', password='".$password."' WHERE id='".$id."'";
	$query = mysql_query($sql);
	return mysql_affected_rows();
}

function deleteData($id) {
	$sql = "DELETE FROM admin WHERE id='".$id."'";
	$query = mysql_query($sql);
	return mysql_affected_rows();
}

sajax_init();
sajax_export("getData","addData","editData","deleteData");
sajax_handle_client_request();
?>

<html>
	<head>
		<title> Jualan Obat</title>	
		<link rel="stylesheet" type="text/css" href="ui/dhtmlx.css">	
		<link rel="stylesheet" type="text/css" href="ui/skins/dhtmlxwindows_clear_blue.css">
		<script  src="ui/dhtmlx.js"></script>	
	</head>
	<body>
		<table align="center">
			<tr> 
				<td colspan="100"><h3>Halaman User</h3></td>			
			</tr>
			<tr>
				<td>
					<input name="submit" id="Tambah" type="submit" value="Tambah" onClick="opsi='add'; createWindow();">
					<input name="txtuser" id="txtuserCari" type="text" value="<? echo $nama ?>" maxlength="30" onKeyUp="opsi='cari'; aksi();">
					<input name="submit" id="cari" type="submit" value="Cari" onClick="opsi='cari'; aksi();">
					<input name="submit" id="ubah" type="submit" value="Edit" onClick="opsi='edit'; createWindow();">
					<input name="button" id="hapus" type="submit" value="Delete" onClick="opsi='delete'; createWindow();">
				</td>
			</tr>
			<tr>
				<td>
					<div id="gridadmin" width="650px" height="580px" style="background-color:white;overflow:hidden;"></div>
				</td>		
			</tr>
		</table>
		<script>
<?
sajax_show_javascript();
?>	var opsi = "add";
	
	var mygrid = new dhtmlXGridObject('gridadmin');
	mygrid.setImagePath("ui/imgs/");
	mygrid.setHeader("NO, nama, email, kelamin, user, Password");
	mygrid.setInitWidths("40,100,150,50,100,200")
	mygrid.setColAlign("left,left,left,left,left,left")
	mygrid.setColTypes("ro,ro,ro");
	mygrid.setColSorting("int,str,str")
	mygrid.setSkin("modern");
	mygrid.init();	
	
	x_getData("", afterGetData);
	
	function afterGetData(data) {
		var strx = "";
		var strFind = "";
		var count = 1;
		var n = 1;
		var k = 0;
		mygrid.clearAll()		
		for (var j=1; j<=data.length; j++) {
			strx = data.substring(j,j+1);						
			if (strx == "|") {			
				strFind = data.substring(count,j);							
				if (k < mygrid.getColumnsNum()-1) {
					if (k == 0) { 
						mygrid.addRow(n,strFind); 				
					}	else {
						mygrid.cells(n,k).setValue(strFind);
					} k += 1;
				} else {
					mygrid.cells(n,k).setValue(strFind);
					k = 0;
					n += 1;						
				} count = j + 1;				
			}			
		}			
	}	
	
	var htmlString = "";
	htmlString += '<body>';
	htmlString += '<table border="0">';
	htmlString += '<tr>';
	htmlString += '<td>NO</td>';
	htmlString += '<td>:	</td>';
	htmlString += '<td><input id="txtid" type="text" size="10"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td>nama</td>';
	htmlString += '<td>:</td>';
	htmlString += '<td><input id="txtnama" type="text" size="30"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td>email</td>';
	htmlString += '<td>:</td>';
	htmlString += '<td><input id="txtemail" type="text" size="30"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td>kelamin</td>';
	htmlString += '<td>:</td>';
	htmlString += '<td><input id="txtkelamin" type="text" size="30"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td>user</td>';
	htmlString += '<td>:</td>';
	htmlString += '<td><input id="txtuser" type="text" size="30"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td>Password</td>';
	htmlString += '<td>:</td>';
	htmlString += '<td><input id="txtpassword" type="password" size="30"></td>';
	htmlString += '</tr>';
	htmlString += '<tr>';
	htmlString += '<td width=100% colspan="3" align="center"><input type="submit" value="OK" onClick="aksi();">';
	htmlString += '<td width=100% colspan="3" align="center"><input type="submit" value="Batal" onClick="cancel();">';
	htmlString += '</td>';
	htmlString += '</td>';
	htmlString += '</tr>';
	htmlString += '</table>';
	htmlString += '</body>';
	
//membuat new window
	var w1;
	function createWindow() {		
		var dhxWins = new dhtmlXWindows();
		dhxWins.enableAutoViewport(true);
		//dhxWins.setViewport(350, 50, 1024, 700);
		dhxWins.setImagePath("ui/imgs/");	
		//dhxWins.setSkin('clear_blue');
		w1 = dhxWins.createWindow("w1", 10, 10, 500, 400);
		w1.setText("Add Data");
		w1.center();
		w1.attachHTMLString(htmlString);
		if (opsi=="add") {
			w1.setText("Add Data");
		} else if  (opsi=="edit") {
			w1.setText("Edit Data");			
			document.getElementById('txtid').value		= mygrid.cells(mygrid.getSelectedId(),0).getValue();
			document.getElementById('txtnama').value	= mygrid.cells(mygrid.getSelectedId(),1).getValue();
			document.getElementById('txtemail').value	= mygrid.cells(mygrid.getSelectedId(),2).getValue();
			document.getElementById('txtkelamin').value	= mygrid.cells(mygrid.getSelectedId(),3).getValue();
			document.getElementById('txtuser').value	= mygrid.cells(mygrid.getSelectedId(),4).getValue();
			document.getElementById('txtpassword').value	= mygrid.cells(mygrid.getSelectedId(),5).getValue();
		} else if  (opsi=="delete") {
			w1.setText("Delete Data");	
			document.getElementById('txtid').value = mygrid.cells(mygrid.getSelectedId(),0).getValue();
		}
	}
	
	function afterAdd(param) {
		//alert(param);
		w1.close();
		x_getData("", afterGetData);
	}
	function cancel(param){
	w1.close();
	x_getData("", afterGetData)
	}
	
	function aksi() {		
		if (opsi=="add") {
			var id = document.getElementById('txtid').value;
			var nama 	= document.getElementById('txtnama').value;
			var email 	= document.getElementById('txtemail').value;
			var kelamin 	= document.getElementById('txtkelamin').value;
			var user 	= document.getElementById('txtuser').value;
			var password 	= document.getElementById('txtpassword').value;
			x_addData(id, nama, email, kelamin, user, password, afterAdd);
		} else if  (opsi=="edit") {
			var id = document.getElementById('txtid').value;
			var nama 	= document.getElementById('txtnama').value;
			var email 	= document.getElementById('txtemail').value;
			var kelamin 	= document.getElementById('txtkelamin').value;
			var user 	= document.getElementById('txtuser').value;
			var password 	= document.getElementById('txtpassword').value;
			x_editData(id, nama, email, kelamin, user, password, afterAdd);			
		} else if  (opsi=="delete") {
			var id = document.getElementById('txtid').value;
			x_deleteData(id, afterAdd);			
		} else if  (opsi=="cari") {
			var user = document.getElementById('txtuserCari').value;
			x_getData(user, afterGetData);			
		}
		
	}
</script>
	</body>
</html>
